
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="prometheus-install/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>Monitoring and Observability</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction-to-prometheus" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Monitoring and Observability" class="md-header__button md-logo" aria-label="Monitoring and Observability" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Monitoring and Observability
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Prometheus
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Monitoring and Observability" class="md-nav__button md-logo" aria-label="Monitoring and Observability" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Monitoring and Observability
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Prometheus
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Prometheus
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-promethues" class="md-nav__link">
    What is Promethues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-isnt-prometheus" class="md-nav__link">
    What isn't Prometheus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features-overview" class="md-nav__link">
    Features Overview
  </a>
  
    <nav class="md-nav" aria-label="Features Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-set" class="md-nav__link">
    Core Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#promql-rules" class="md-nav__link">
    PromQL Rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defined-discovered" class="md-nav__link">
    Defined &amp; Discovered
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pushing" class="md-nav__link">
    Pushing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pushgateway" class="md-nav__link">
    PushGateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-server" class="md-nav__link">
    Prometheus Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alertmanager" class="md-nav__link">
    Alertmanager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exporters" class="md-nav__link">
    Exporters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="prometheus-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prometheus Install
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grafana
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-promethues" class="md-nav__link">
    What is Promethues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-isnt-prometheus" class="md-nav__link">
    What isn't Prometheus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features-overview" class="md-nav__link">
    Features Overview
  </a>
  
    <nav class="md-nav" aria-label="Features Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-set" class="md-nav__link">
    Core Set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#promql-rules" class="md-nav__link">
    PromQL Rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defined-discovered" class="md-nav__link">
    Defined &amp; Discovered
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pushing" class="md-nav__link">
    Pushing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pushgateway" class="md-nav__link">
    PushGateway
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prometheus-server" class="md-nav__link">
    Prometheus Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alertmanager" class="md-nav__link">
    Alertmanager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exporters" class="md-nav__link">
    Exporters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="introduction-to-prometheus">Introduction to Prometheus</h1>
<h2 id="what-is-promethues">What is Promethues</h2>
<p>Protmetheus is an open-source monitoring tool, mostly written in the 'Go' language by SoundCloud. It is specifically made for short-term monitoring. It has multi-dimensional data with time-series which is identified by Metric Name that are represented in Key/Value Pairs (Key:Value). It primarily pulls metric from an endpoint but there is also a Push gateway involved in some deployments.</p>
<ul>
<li>Prometheus has a strong suite in Machine Centric Monitoring</li>
<li>Even a stronger suite in Dynamic service-oriented architectures (microservices)</li>
<li>It is designed for reliability. Standalone and Independent of the larger architecture, totally decoupled from everything</li>
</ul>
<h2 id="what-isnt-prometheus">What isn't Prometheus</h2>
<ul>
<li>It is not a long term metric storage solution</li>
<li>Does not have a 100% accuracy in metrics</li>
<li>Not meant for deep, detailed metrics. Instead, it is good at -<ul>
<li>Summarizing Metrics</li>
</ul>
</li>
<li>It is not a push oriented metrics system as its main strength is pulling metrics</li>
</ul>
<h2 id="features-overview">Features Overview</h2>
<h4 id="core-set">Core Set</h4>
<ul>
<li>Time series Data Identification<ul>
<li>Metric name</li>
<li>Key Value Pairs</li>
</ul>
</li>
<li>Functional Query Language; built on a specific, custom, PromQL tool. PromQL performs aggregation in real-time. These can be graphed and consumed by external systems via HTTP API.</li>
<li>Pre-configured rules can speed up longer queries.</li>
<li>It also provides flexible graphing and dashboarding using PromDash; a GUI based builder having an SQL backend.</li>
<li>HTTP API, which is involved in the prometheus server and exists as <code>/api/v1</code></li>
</ul>
<h4 id="promql-rules">PromQL Rules</h4>
<ul>
<li>In the configuration file -recording rules are referred to via a file containing their configuration. So we have <code>rule_files</code> :<ul>
<li><code>prometheus.rules.yaml</code></li>
</ul>
</li>
</ul>
<pre><code class="language-yaml">groups:
  # name of the rule
- name: 
  rules:
    # the rules by recording
  - record: 
    # the expressions we want to evaluate them against
    expr: 
</code></pre>
<ul>
<li>Prometheus is non-reliant on a distributed storage system. As a result, it gets high througput using the on-node storage.</li>
<li>Non-meant as a long term storage solution. Ideally for 3-6 months of storage. And then engineers might want to upload the data to Thanos.</li>
<li>Prometheus collects its metrics using HTTP Pulls (one URI per exporter)</li>
<li>Prometheus scrapes these endpoints and the endpoints can either be defined or discovered</li>
</ul>
<h4 id="defined-discovered">Defined &amp; Discovered</h4>
<ul>
<li>Prometheus collects metrics over HTTP Pulls, which can either be -<ul>
<li>Defined: Statically configured in the YAML file</li>
<li>Discovered: Automatically discovered by Prometheus using its' DNS discovery service</li>
</ul>
</li>
</ul>
<pre><code class="language-yaml"># Defined 
- job name: prometheus
  honor_timestamps: true
  scrape_interval: 5s
  scrap_timeout: 5s
  metrics_path: /metrics
  scheme: http
  static_configs:
  - targets:
    - localhost: 9090
</code></pre>
<h4 id="pushing">Pushing</h4>
<ul>
<li>Pushing is available through the PushGateway. It is used for non-scrapable components and for short-lived jobs.</li>
<li>It can also be used to present metrics to prometheus for pulling. You can think of this as an intermediary server that prometheus can pull from.</li>
</ul>
<h2 id="components">Components</h2>
<h4 id="pushgateway">PushGateway</h4>
<p>PushGateway is best suited for service-level jobs because when we have an intermediary pushing the metrics, it can also be a single point of failure for those metrics. If we build our critical layers on system level information and our PushGateway failed, so would our alerting. This is why PushGateway needs to act for only service short-lived jobs.</p>
<p>The native health monitoring that Prometheus generates is not generated on PushGateway instances. That's because the inteneded purpose of this metrics is jobs to push and then exit</p>
<p>Metrics pushed to the PushGateway are not destroyed which Prometheus usually does. So they persist even after the jobs are exited. So they will be exposed to Prometheus forever until they are manually deleted via the PushGateway's API. </p>
<h4 id="prometheus-server">Prometheus Server</h4>
<p>The prometheus server may look monolithic in nature but it has several components.</p>
<ul>
<li>Retrieval Worker - Goes out and scrapes the endpoints</li>
<li>The Storage Database<ul>
<li>Connects to local Node Storage</li>
<li>Time Series Database</li>
</ul>
</li>
<li>HTTP Server <ul>
<li>Dashboarding</li>
<li>API - Responses are in JSON</li>
<li>Plug into our Alertmanager</li>
</ul>
</li>
</ul>
<p>But how is Prometheus Configured? Let's look at a Prometheus config file. We will divide the prometheus config file into several blocks -</p>
<pre><code class="language-yaml">global:
    scrape_interval: 15s
    scrape_timeout: 10s
    evaluation_interval: 1m
    external_labels:
        monitor: Cloudcademy-Prom-Demo

rule_files:
- prometheus.rules.yaml

scrape_configs:
# we can mention specific jobs here 
# this job is monitoring prometheus after every 5s from the /metrics path 
# and it is hosted on 9090 port
- job name: prometheus
  honor_timestamps: true
  scrape_interval: 5s
  scrap_timeout: 5s
  metrics_path: /metrics
  scheme: http
  static_configs:
  - targets:
    - localhost: 9090

- job_name: Prom1-node
  honor_timestamps: true
  scrape_interval: 5s
  scrap_timeout: 5s
  metrics_path: /metrics
  scheme: http
  static_configs:
  - targets:
    - localhost: 8080
    - localhost: 8081
    labels:
      group: CloudAcademy-Prod
  - targets:
    - localhost: 8082
    labels:
      group: CloudAcademy-Dev
</code></pre>
<h4 id="alertmanager">Alertmanager</h4>
<p>Alertmanager handles alerts sent by client applications, sends them along their way and routes them to the correct receiver, whether that be - Email, PagerDuty etc. </p>
<p><strong>Grouping:</strong> It also has ways to group alerts into a single notification. So you are not alerted every single time an instance maybe failing. </p>
<p><strong>Inhibition:</strong> It also has the ability to prevent alerts from failing if another alert is going on. For example - If alert X is alerting, don't turn trigger alert Y. This could be useful in situations for example if a whole cluster is down, we don't need alerts for every instances within that cluster and their alerts. </p>
<p><strong>Silences:</strong> There is also ability to mute alerts for given period of time. </p>
<p><strong>High-Availability:</strong> There is high availability for multi-cluster support available through a command-line plug</p>
<h4 id="exporters">Exporters</h4>
<p>Exporters are open-source generally and they are tailored for Prometheus. They - </p>
<ul>
<li>Grab metrics for Prometheus</li>
<li>Alter those metrics into a Prometheus format<ul>
<li>Using a client library such as - GO, Java or Scala, Python, Ruby</li>
</ul>
</li>
<li>After this they typically start a web server for themselves to be scraped upon</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>